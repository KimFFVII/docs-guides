= Creating a new OneCX Angular App

[#general-overview]
== General Overview

After link:https://onecx.github.io/docs/onecx-local-env/current/general/index.html[setting up the onecx-environment locally], you can begin creating your own application within this environment. This guide walks through the process of building a simple "Hello World" Angular app and integrating it into the OneCX environment.
To integrate an application into the OneCX environment, it should follow the standard architecture consisting of three main services (ui, bff and svc).
These services are consumed by the OneCX shell, which orchestrates and displays the UI components within the broader platform.

[#creating-the-ui]
== Creating the UI

[#creating-basic-ui-structure]
=== 1. Create the basic UI structure

We start with creating the UI structure of our "Hello World" App by running the following commands using the custom OneCX generator.

Please check the link:https://onecx.github.io/docs/nx-plugins/current/general/getting_started/prerequisites.html[prerequisites for using the generator] before starting.

[#setup-new-angular-workspace]
==== Setup New Angular Workspace

First, we can generate the basic project structure and required files for the application.
This includes necessary configuration and build files, initial Angular source code, generated API services, translation assets, Swagger specifications, environment settings and Helm deployment configurations.

We can set up the new Angular workspace by running:

[source,sh]
----
npx @onecx/create-workspace ngrx hello-world
----
NOTE: Details to generating a new OneCX Angular workspace can be found link:https://onecx.github.io/docs/nx-plugins/current/general/getting_started/new-onecx-app.html[here].

Navigate into the newly created hello-world directory and install the packages with `npm install`. 

[#adding-feature-module]
==== Add a Feature Module

Now we want to add a feature module to our application, that encapsulates the functionality of our new feature "hello". Therefore a new folder with the name of the feature module will be created in the `/src/app/` directory.

This will be generated by running the following command:

[source,sh]
----
nx generate @onecx/nx-plugin:feature hello
----
NOTE: Details to generating a feature module can be found link:https://onecx.github.io/docs/nx-plugins/current/general/getting_started/feature-module.html[here].

[#adding-search-page]
==== Add a Search Page

Additionally we can add a search feature, that includes a table and allows users to search for an item in a certain column.
The search page can be generated in the same way as the feature module:

[source,sh]
----
nx generate @onecx/nx-plugin:search hello
----
NOTE: Details to generating a search page can be found link:https://onecx.github.io/docs/nx-plugins/current/general/getting_started/search-page.html[here].

[#adding-details-page]
==== Add a Details Page

Now we can also create a details page for the items in the search results by running:

[source,sh]
----
nx generate @onecx/nx-plugin:details hello
----
NOTE: Details to generating a details page can be found link:https://onecx.github.io/docs/nx-plugins/current/general/getting_started/details-page.html[here].

[#adding-create-update-page]
==== Add a Create-Update Dialog

Additionally we can add a create and update dialog for creating and updating items on the page by running:

[source,sh]
----
nx generate @onecx/nx-plugin:create-update hello
----
NOTE: Details to generating a create-update dialog can be found link:https://onecx.github.io/docs/nx-plugins/current/general/getting_started/create-update-dialog.html[here].

The application can now be built, tested and started by running `npm run build`, `npm run test` and `npm start`.

For further customization of the app, you can refer to the general link:https://onecx.github.io/docs/[OneCX generator documentation].

[#include-application-in-onecx-environment]
=== 2. Include application in OneCX environment

Now let's integrate the "Hello World" app into the OneCX environment using the onecx-local-env. *This section assumes your local environment is already set up and running*.

[#synchronization]
==== Synchronization

In your hello-world UI folder, sync the app with your local environment (adjust the path to your `onecx-local-env`):

[source,sh]
----
npx @onecx/local-env-cli sync ui hello-world /hello-world ./helm/values.yaml -e /path/to/onecx-local-env -n hello-world-ui
----

In this command:

- `hello-world` refers to the product name,
- `/hello-world` specifies the product's base path,
- `./helm/values.yaml` is the path to the application's `values.yaml` file, that was generated by the OneCX generator

This command will adjust the files in your onecx-local-env to include the necessary information about the new application's UI.

[#adding-menu-entry]
==== Add Menu Entry

Add a menu entry for the new application in the OneCX environment by running (adjust the path to your `onecx-local-env` again):

[source,sh]
----
npx @onecx/local-env-cli menu create hello-world-ui /hello-world/hello "Hello World" -e /path/to/onecx-local-env
----

This command will create a new menu entry "Hello World" under Custom Applications with the path to the applications feature module `/hello-world/hello`.

[#adding-to-docker-compose]
==== Add the UI to Docker Compose

Add the UI as an image to the `docker-compose.yaml` of your `onecx-local-env` with the following command (adjust the path to your `onecx-local-env` again):

[source,sh]
----
npx @onecx/local-env-cli docker hello-world create hello-world helloWorld -e /path/to/onecx-local-env -s ui
----

Now a `hello-world.docker-compose.yaml` should be created in the onecx-local-env containing an image for `hello-world-ui`.

NOTE: More details to the onecx-local-env-cli can be found link:https://github.com/onecx/onecx-local-env-cli/[here].

[#creating-the-bff]
== Creating the BFF

As we did for the UI, we can sync the app with your local environment for the bff and add the bff to our hello-world.docker-compose.yaml as well. The ./helm/values.yaml path refers to the values.yaml file of the bff.

[source,sh]
----
npx @onecx/local-env-cli sync bff hello-world /hello-world ./helm/values.yaml -e /path/to/onecx-local-env
npx @onecx/local-env-cli docker hello-world create hello-world helloWorld -e /path/to/onecx-local-env -s bff
----

[#creating-the-svc]
== Creating the SVC

As we did for the UI and BFF, we can sync the app with your local environment for the svc and add the svc to our hello-world.docker-compose.yaml as well. The ./helm/values.yaml path refers to the values.yaml file of the svc.

[source,sh]
----
npx @onecx/local-env-cli sync svc hello-world /hello-world ./helm/values.yaml -e /path/to/onecx-local-env
npx @onecx/local-env-cli docker hello-world create hello-world helloWorld -e /path/to/onecx-local-env -s svc
----

*Now that the services are created, the application can be run in the OneCX environment as described xref:running_custom_apps_overview.adoc#running-and-testing-applications[here].*